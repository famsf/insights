{% macro id(chapter) %}
  {{- chapter.id|default('chapter' ~ chapter.index) -}}
{% endmacro %}
{% import _self as get %}
{% set id = get.id(_context) %}
{% set isFirstChapter = (index == 0) %}

{# Set default chapter wrapper tag #}
{% if tag is not defined  %}
  {% set tag = 'section' %}
{% endif %}

<{{ tag }} class="chapter {{ classes }}" id="{{ id }}" data-chapter-index="{{ index }}" data-chapter-length="{{ pages|length }}" data-snap-id="{{ snap_id }}">
  {% for page in pages %}
    {# Use "passthrough" to send chapter/story data to CoverPage + chapter__title. #}
    {# On CoverPage, use the story title instead of chapter title. #}
    {% set isFirstPageOfChapter = loop.first %}
    {%
      include "@organisms/Page/Page.html.twig" with page|merge({
        index: loop.index0,
        chapter: id,
        passthrough: isFirstPageOfChapter ? {
          title: isFirstChapter ? story : title,
          numeral: numeral,
        } : {},
      }) only
    %}
  {% endfor %}
</{{ tag }}>
